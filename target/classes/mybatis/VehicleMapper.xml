<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.example.busmanagement.dao.VehicleMapper">

    <!-- 分页查询所有车辆 -->
    <select id="selectAll" resultType="org.example.busmanagement.model.entity.BusVehicle">
        SELECT * FROM bus_vehicles
        ORDER BY vehicle_id DESC
        LIMIT #{pageNum}, #{pageSize}
    </select>

    <!-- 查询总记录数 -->
    <select id="countTotal" resultType="int">
        SELECT COUNT(*) FROM bus_vehicles
    </select>

    <!-- 根据ID查询车辆 -->
    <select id="selectById" resultType="org.example.busmanagement.model.entity.BusVehicle">
        SELECT * FROM bus_vehicles WHERE vehicle_id = #{vehicleId}
    </select>

    <!-- 根据线路ID查询车辆 -->
    <select id="selectByRouteId" resultType="org.example.busmanagement.model.entity.BusVehicle">
        SELECT * FROM bus_vehicles
        WHERE route_id = #{routeId}
        ORDER BY vehicle_id ASC
    </select>

    <!-- 新增车辆 -->
    <insert id="insert" useGeneratedKeys="true" keyProperty="vehicleId">
        INSERT INTO bus_vehicles (
            route_id, license_plate, vehicle_type, purchase_time,
            mileage, status, driver_id
        ) VALUES (
                     #{routeId}, #{licensePlate}, #{vehicleType}, #{purchaseTime},
                     #{mileage}, #{status}, #{driverId}
                 )
    </insert>

    <!-- 更新车辆信息 -->
    <update id="update">
        UPDATE bus_vehicles SET
                                route_id = #{routeId},
                                license_plate = #{licensePlate},
                                vehicle_type = #{vehicleType},
                                purchase_time = #{purchaseTime},
                                mileage = #{mileage},
                                status = #{status},
                                driver_id = #{driverId}
        WHERE vehicle_id = #{vehicleId}
    </update>

    <!-- 更新车辆状态 -->
    <update id="updateStatus">
        UPDATE bus_vehicles SET status = #{status} WHERE vehicle_id = #{vehicleId}
    </update>

    <!-- 检查车牌号是否已存在 -->
    <select id="countByLicensePlate" resultType="int">
        SELECT COUNT(*) FROM bus_vehicles WHERE license_plate = #{licensePlate}
    </select>

    <!-- 删除车辆 -->
    <delete id="deleteById">
        DELETE FROM bus_vehicles WHERE vehicle_id = #{vehicleId}
    </delete>
</mapper>